#!/usr/bin/make -f

%:
	dh $@

override_dh_auto_configure:
	ln -sf /usr/share/misc/config.sub .
	ln -sf /usr/share/misc/config.guess .
	rm -f .hg*
	dh_auto_configure -- --disable-rpath --enable-chardet

override_dh_auto_clean:
	rm -f config.sub
	rm -f config.guess
	find po -name \*.gmo -exec rm -f {} \;
	rm -f  man/*.1 po/stamp-po config.guess config.sub config.status \
		config.log config.h *.pc \
		src/audacious/dbus-client-bindings.h \
		src/audacious/dbus-server-bindings.h \
		src/audacious/build_stamp.c
	dh_auto_clean
	rm -f buildsys.mk

override_dh_strip:
	dh_strip --dbg-package=audacious-dbg

override_dh_install:
	dh_install --sourcedir=debian/tmp/
	ln -sf /usr/share/man/man1/audacious2.1 debian/tmp/usr/share/man/man1/audacious.1
	ln -sf /usr/share/man/man1/audtool2.1 debian/tmp/usr/share/man/man1/audtool.1


override_dh_installdirs:
	dh_installdirs
	mkdir -p ./debian/tmp/usr/share/pixmaps
	for size in 16 22 24 32 36 48; do \
		convert $(CURDIR)/pixmaps/audacious2.png -resize $${size} \
			./debian/tmp/usr/share/pixmaps/audacious-$${size}.xpm || exit 1; \
		mkdir -p ./debian/tmp/usr/share/icons/hicolor/$${size}x$${size}/apps || exit 1;  \
		convert $(CURDIR)/pixmaps/audacious2.png -resize $${size} \
			./debian/tmp/usr/share/icons/hicolor/$${size}x$${size}/apps/audacious2.png || exit 1; \
	done
	rm -f ./debian/tmp/usr/share/pixmaps/audacious2.png
